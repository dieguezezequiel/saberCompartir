"use strict";angular.module("frontendApp",["underscore","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ui-rangeSlider","timer","directives.module","scService","ConstantsService"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("inicio",{url:"/",templateUrl:"views/inicio.html",controller:"InicioCtrl"}).state("registro",{url:"/registro",templateUrl:"views/registro.html",controller:"RegistroCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("dictado",{url:"/dictado",templateUrl:"views/dictado.html",controller:"DictadoCtrl"}).state("presenciado",{url:"/presenciado/:id",templateUrl:"views/presenciado.html",controller:"PresenciadoCtrl"})}]),angular.module("frontendApp").controller("InicioCtrl",["$scope","HomeResource","$q",function(a,b,c){a.hide=!1;var d=[b.getSolicitudesMasSolicitadas()];c.all(d).then(function(b){a.solicitudes=b[0]}),a.sumarse=function(b){b.totalUsers=b.totalUsers+1,a.hide=!0,new PNotify({title:"Genial!",text:"Te acabas de sumar a la solicitud de "+b.subject,type:"success"})}}]),angular.module("directives.module",[]).directive("customForm",["$timeout",function(a){return{template:'<form novalidate name="{{fName}}" class="form-horizontal" role="form" ng-submit="submitActionInterno()"><div ng-transclude></div></form>',restrict:"AE",transclude:!0,require:["form","customForm"],replace:!0,scope:{submitAction:"&",fName:"@"},link:function(a,b,c,d){var e=d[0],f=d[1];f.formController=e},controller:["$scope",function(a){a.submitActionInterno=function(){a[b].$valid&&a.submitAction()};var b=this.$name=a.fName=a.fName||"form";this.showHelpBlock=function(c){var d=!1;return"undefined"!=typeof a[b][c]&&(d=a[b].$submitted&&a[b][c].$invalid),d}}]}}]).directive("scInputLabel",["$compile","$timeout",function(a,b){return{templateUrl:"templates/directives/sc-inputLabel.html",restrict:"AE",replace:!0,require:"^customForm",scope:{model:"=",label:"@",inputName:"@",placeholder:"@",type:"@?",helpMsg:"@",maxlength:"@?",minlength:"@?",disabled:"=?",required:"=",iconText:"@?",labelCol:"=?",inputCol:"=?",notShowLabel:"=?",validators:"=?",regex:"@?"},link:function(c,d,e,f){c.showHelpBlock=f.showHelpBlock;var g=function(b,e){var f=d.find("input");f.attr(b,e),a(f)(c)};b(function(){c.validators&&c.validators.forEach(function(a){g(a,"")})},0)}}}]),angular.module("frontendApp").controller("DictadoCtrl",["$scope","$scService","$q","Constants","_","$stateParams",function(a,b,c,d,e,f){var g=new SimpleWebRTC({localVideoEl:"localVideo",autoRequestMedia:!0,url:d.URL_SIGNALING_SERVER});a.cantidadUsuariosConectados=0,a.readyToCall=!1,a.claseEnCurso=!1,a.tiempoDeClase=0,a.estadoClase=d.EstadosClase.CONECTANDO,a.cantidadMensajes=0,a.usuariosConectados=[],a.volumen=8,a.volumenMin=0,a.volumenMax=10,a.microfonoMuteado=!1,a.duracionClase=0,a.startTimer=function(){a.$broadcast("timer-start"),a.timerRunning=!0},a.stopTimer=function(){a.$broadcast("timer-stop"),a.timerRunning=!1},a.$on("timer-stopped",function(a,b){console.log("Timer Stopped - data = ",b)}),a.enviarMensaje=function(){},a.enviarMensajeAUsuario=function(){},a.comenzarClase=function(){g.createRoom(a.clase.id.toString(),function(c,e){c?console.log(c):(console.log(e),a.estadoClase=d.EstadosClase.EN_CURSO,a.claseEnCurso=!0,a.clase.state=3,b.updateClase(a.clase),a.startTimer()),a.$apply()})},a.terminarClase=function(){g.stopScreenShare(),g.stopLocalVideo(),g.leaveRoom(),g.disconnect(),a.estadoClase=d.EstadosClase.FINALIZADA,a.clase.state=4,b.updateClase(a.clase),a.stopTimer()},a.mutearMicrofono=function(){a.microfonoMuteado?a.desmutearMicrofono():(g.mute(),a.microfonoMuteado=!0)},a.desmutearMicrofono=function(){g.unmute(),a.microfonoMuteado=!1},a.estadoClaseChange=function(){},g.on("readyToCall",function(b){console.log(b),a.estadoClase=d.EstadosClase.EN_ESPERA,a.readyToCall=!0,a.$apply()}),g.on("localMediaError",function(b){a.estadoClase=d.EstadosClase.LOCAL_MEDIA_ERROR}),g.on("createdPeer",function(b){var c={id:b.id,nombre:b.nick};a.usuariosConectados.push(c),a.cantidadUsuariosConectados=a.cantidadUsuariosConectados+1,a.$apply()}),g.connection.on("remove",function(b){a.cantidadUsuariosConectados=a.cantidadUsuariosConectados-1,a.usuariosConectados.pop(),a.$apply()}),g.on("leftRoom",function(b){console.log("Terminaste la clase ",b),a.cantidadUsuariosConectados=0}),a.$on("$destroy",function(){a.terminarClase()}),a.volumenChange=function(){},a.abrirChat=function(){a.showChat=!0,a.showChatConfiguracion=!1,a.showUsuariosConectados=!1},a.abrirUsuariosConectados=function(){a.showChat=!1,a.showChatConfiguracion=!1,a.showUsuariosConectados=!0},a.abrirChatConfiguracion=function(){a.showChat=!1,a.showChatConfiguracion=!0,a.showUsuariosConectados=!1},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},a.init=function(){b.getEstablishedClassroom().then(function(b){a.clase=b.data,a.abrirChat(),a.claseIsValid=!0},function(b){console.log(b.data),a.claseIsValid=!1})},a.init()}]),angular.module("frontendApp").controller("PresenciadoCtrl",["$scope","$scService","$q","Constants","$stateParams","$location",function(a,b,c,d,e,f){a.idClase=e.id,a.enviarMensaje=function(){},a.enviarMensajeAUsuario=function(){},a.abrirChat=function(){a.showChat=!0,a.showChatConfiguracion=!1,a.showUsuariosConectados=!1},a.abrirUsuariosConectados=function(){a.showChat=!1,a.showChatConfiguracion=!1,a.showUsuariosConectados=!0},a.abrirChatConfiguracion=function(){a.showChat=!1,a.showChatConfiguracion=!0,a.showUsuariosConectados=!1},a.joinClassRoom=function(){a.webrtc=new SimpleWebRTC({media:{video:!1,audio:!1},url:d.URL_SIGNALING_SERVER,nick:"Ricardo Fort",remoteVideosEl:"remoteVideo"}),a.abrirChat(),a.webrtc.on("connectionReady",function(b){a.webrtc.joinRoom(a.clase.id.toString(),function(a,b){console.log(a),console.log(b)})}),a.webrtc.on("createdPeer",function(a){console.log(a)})},a.init=function(){b.getClaseById(a.idClase).then(function(b){if(a.clase=b.data,a.clase)switch(a.clase.state){case 0:break;case 1:a.joinClassRoom();break;case 2:a.joinClassRoom();break;case 3:a.joinClassRoom();break;case 4:break;case 5:}else f.path("/")},function(a){return!1})},a.init()}]);var LETRAS_REGEXP=/^[a-zA-Z ñÑ]*$/,NUMEROS_REGEXP=/^[0-9]*$/;angular.module("directives.module").directive("soloNumeros",function(){return{require:"ngModel",link:function(a,b,c,d){var e="",f=a;d.$formatters.unshift(function(a){if(void 0!=a){var b=""===a||a&&NUMEROS_REGEXP.test(a);e=b?a:e,f.model=e,d.$setValidity("soloNumeros",b)}return b?e:""})}}}).directive("soloLetras",function(){return{require:"ngModel",link:function(a,b,c,d){var e="",f=a;d.$formatters.unshift(function(a){if(void 0!=a){var b=""===a||a&&LETRAS_REGEXP.test(a);e=b?a:e,f.model=e,d.$setValidity("soloLetras",b)}return b?a:e})}}}).directive("sinEspacios",function(){return{require:"ngModel",link:function(a,b,c,d){b.bind("keypress",function(a){var b=a.keyCode||a.which;if(32==b)return!1})}}}),angular.module("scService",[]).factory("$scService",["$http","HomeResource",function(a,b){var c={};return c.getStreamingActuales=function(){return[1,2,3,4,5,6,7,8]},c.getStreamingProgramados=function(){return[1,2,3,4,5,6,7,8]},c.getRankingUsuarios=function(){return[1,2,3,4,5,6,7,8]},c.getRankingSolicitudes=function(){return b.getSolicitudesMasSolicitadas()},c.updateClase=function(b){var c="api/classroom/"+b.id;return a.put(c,b)},c.getClaseById=function(b){var c="api/classroom/"+b;return a.get(c)},c.getClassroomsByState=function(b){var c="api/classroom?state="+b;return a.get(c)},c.getEstablishedClassroom=function(){var b="api/classroom/established";return a.get(b)},c}]),angular.module("ConstantsService",[]).constant("Constants",{EstadosClase:{EN_ESPERA:"Todo listo! Ya puedes empezar tu clase.",EN_CURSO:"Clase en curso.",FINALIZADA:"Clase finalizada.",ERRONEA:"Ha ocurrido un error :( Inténtelo de nuevo :)",LOCAL_MEDIA_ERROR:"Parece que has olvidado permitir el acceso de tu cámara web y micrófono, ¿no?",CONECTANDO:"Estamos conectándote al mundo, espere un momento."},URL_SIGNALING_SERVER:"http://localhost:8888"}),angular.module("frontendApp").service("notificationService",function(){return{showMessage:function(a){return new PNotify({title:a.title,text:a.text,type:a.type})}}}),angular.module("frontendApp").controller("RegistroCtrl",["$scope","UsuarioResource","notificationService",function(a,b,c){a.usuario={},a.guardar=function(){var d=b.create(a.usuario);d.$promise.then(function(a){c.showMessage(a)})}}]),angular.module("frontendApp").controller("LoginCtrl",["$scope","UsuarioResource",function(a,b){a.usuario={},a.loguear=function(){b.login(a.usuario)}}]),angular.module("frontendApp").factory("UsuarioResource",["$resource",function(a){var b="api/usuarios/";return a(b,{},{create:{method:"POST"},login:{method:"POST",url:b+"login"}})}]),angular.module("frontendApp").factory("HomeResource",["$resource",function(a){var b="api/home/";return a(b,{},{getSolicitudesMasSolicitadas:{method:"GET",isArray:!0}})}]),angular.module("frontendApp").run(["$templateCache",function(a){a.put("views/dictado.html",'<!--\n  Informacion:\n  -Cantidad de usuarios conectados a la clase.\n  -Video local\n  -Chat\n\n  Controles:\n  -Control de volumen de mic.\n  -Agrandar/achicar video local (sólo para el usuario que está streameando)\n\n\n  Administracion:\n  -Administrar chat.\n  -Terminar clase.\n  -Empezar clase. (La clase no empieza automaticamente se accede a la cam y mic)\n\n--> <div class="container dictado-container"> <div class="row full-height-percent top-buffer"> <div class="col-lg-6 col-md-6 col-xs-12"> <div class="row"> <div class="col-lg-12"> <div class="video-container"> <video id="localVideo"></video> </div> </div> </div> <div class="row"> <div class="col-lg-1"> <!--          <div range-slider\n               class="volumen no-margin"\n               orientation="vertical right"\n               on-handle-up="volumenChange()"\n               min="volumenMin"\n               max="volumenMax"\n               model-max="volumen"\n               pin-handle="min"></div>\n        --> <button ng-click="mutearMicrofono()" class="btn btn-default btn-lg btn-link" ng-class="microfonoMuteado ? \'color-red\': \'color-green\'"> <span class="glyphicon glyphicon-volume-up"></span> </button> </div> <div class="col-lg-11"> <div class="row"> <div class="col-lg-12 col-md-12 col-xs-12"> <div class="panel panel-default controls-container text-center"> <div class="panel-body"> <button class="btn btn-success" ng-show="!claseEnCurso" ng-click="comenzarClase()">COMENZAR</button> <button class="btn btn-success" ng-show="claseEnCurso" ng-click="terminarClase()">TERMINAR</button> </div> </div> </div> <div class="col-lg-12 col-md-12 col-xs-12"> <div class="panel panel-default info-streaming-container"> <div class="panel-body"> <div class="tiempo-container text-center"> <!--Formatear a hh:mm:ss--> <p><timer autostart="false" interval="1000">{{hhours}}:{{mminutes}}:{{sseconds}}</timer></p> </div> <div class="mensajes-container text-center"> <p><b>Estado: </b>{{estadoClase}}</p> </div> </div> </div> </div> </div> </div> </div> </div> <!--En mobile esto se oculta y se ve se hace--> <div class="col-lg-6 col-md-6 full-height-percent"> <div class="row full-height-percent"> <div class="col-lg-11 col-md-11 full-height-percent overflow-hidden"> <!--CHAT CONTAINER--> <div class="row chat-container full-height-percent animation-chat" ng-class="showChat ? \'animation-show\' : \'animation-hide\'"> <div class="col-lg-12 messages-container"> <ul class="messages"></ul> </div> <div class="col-lg-12"> <div class="input-group"> <input type="text" class="form-control" placeholder=":)"> <span class="input-group-btn"> <button class="btn btn-default" ng-click="enviarMensaje()" type="button">Go!</button> </span> </div> </div> </div> <!--USUARIOS CONECTADOS CONTAINER--> <div class="row full-height-percent animation-chat" ng-class="showUsuariosConectados ? \'animation-show\' : \'animation-hide\'"> <h3>USUARIOS CONECTADOS</h3> <ul ng-repeat="usuario in usuariosConectados"> <li>{{usuario.nombre}}</li> </ul> </div> <!--CHAT CONFIGURACION CONTAINER--> <div class="row full-height-percent animation-chat" ng-class="showChatConfiguracion ? \'animation-show\' : \'animation-hide\'"> <div class="list-group"> <h3>CONFIGURACIÓN</h3> <button type="button" class="list-group-item">Chat</button> <button type="button" class="list-group-item">Usuarios</button> <button type="button" class="list-group-item">Ayuda</button> <button type="button" class="list-group-item">Reportar problema</button> </div> </div> </div> <div class="col-lg-1 col-md-1"> <div class="row"> <div class="col-lg-12 no-padding margin-top-10"> <div class="icon-badge-container"> <button ng-click="abrirChat()" class="btn btn-default btn-lg btn-link" ng-class="showChat ? \'active\': \'\'"> <span class="glyphicon glyphicon-comment"></span> </button> <span class="badge badge-notify">{{cantidadMensajes}}</span> </div> </div> <div class="col-lg-12 no-padding margin-top-10"> <div class="icon-badge-container"> <button ng-click="abrirUsuariosConectados()" class="btn btn-default btn-lg btn-link" ng-class="showUsuariosConectados ? \'active\': \'\'"> <span class="glyphicon glyphicon-user"></span> </button> <span class="badge badge-notify">{{cantidadUsuariosConectados}}</span> </div> </div> <div class="col-lg-12 no-padding margin-top-10"> <button type="button" ng-click="abrirChatConfiguracion()" class="btn btn-default btn-lg btn-link" aria-label="Left Align" ng-class="showChatConfiguracion ? \'active\': \'\'"> <span class="glyphicon glyphicon-cog" aria-hidden="true"></span> </button> </div> </div> </div> </div> </div> </div> </div>'),a.put("views/inicio.html",'<div class="hero-unit home text-center"> <div class="vertical-center"> <img src="../../images/logo1.8edb8733.png" alt=""> <h2>Compartir es más fácil.</h2> </div> <h1> <p class="element-bottom"><a href="#"><i class="glyphicon glyphicon-chevron-down"></i></a></p> </h1> </div> <div class="container-home container container-home"> <div class="row"> <span class="titulo-blanco col-xs-12"><span class="glyphicon glyphicon-book"></span> Clases mas solicitadas</span> </div> </div> <div class="container"> <div class="row"> <div ng-repeat="solicitud in solicitudes" class="col-md-4"> <!--1--> <div class="panel panel-default"> <div class="panel-body"> <div ng-hide="hide" class="mas cursor" ng-click="sumarse(solicitud)"> <span class="glyphicon glyphicon-plus"></span> <spans> Me Sumo</spans> </div> <div class="col-xs-12 titulo-violeta">{{solicitud.subject}}</div> <p class="col-xs-12">Personas interesadas: {{solicitud.totalUsers}}</p><p> </p><p class="col-xs-12">Puntos por dar clase: {{solicitud.points}}</p><p> </p><p class="col-xs-12">Estado: {{solicitud.state}}</p><p> <div class="mas cursor" ng-click="solicitud.state = \'A Realizarse\'"> <span class="glyphicon glyphicon-user"></span> <spans> Voy a dar esta clase</spans> </div> </p></div> </div> </div> </div> </div>'),a.put("views/login.html",'<div class="container"> <div class="row"> <div class="col-md-12 formulario"> <div class="panel"> <div class="panel-heading"> <div class="panel-title">Iniciar Sesión</div> </div> <div class="panel-body"> <div custom-form f-name="FormLogin" submit-action="loguear()" class="form-horizontal"> <div class="form-group"> <div class="col-xs-12"> <sc-input-label type="email" not-show-label="true" model="usuario.email" placeholder="Email" help-msg="Ingrese su email" input-name="emailUsuario" maxlength="50" minlength="4" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-xs-12"> <sc-input-label type="password" not-show-label="true" model="usuario.password" placeholder="Contraseña" help-msg="Ingrese su contraseña, minimo 6 caracteres" input-name="passwordUsuario" maxlength="50" minlength="6" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-md-12 buttonRegistro"> <button type="submit" class="btn btn-primary btn-md">Iniciar sesion</button> </div> </div>  </div> </div> </div> </div> </div> </div>'),a.put("views/presenciado.html",'<!--\n  Informacion:\n  -Cantidad de usuarios conectados a la clase.\n  -Video remoto\n  -Chat\n\n  Controles:\n  -Agrandar/achicar video local\n\n--> <div class="container presenciado-container"> <div class="row full-height-percent top-buffer"> <div class="col-lg-8 col-md-8 col-xs-12"> <div class="row"> <div class="col-lg-12"> <div class="video-container" id="videoContainer"> <div class="video" id="remoteVideo"> </div> </div> </div> </div> </div> <!--En mobile esto se oculta y se ve se hace--> <div class="col-lg-4 col-md-4 full-height-percent"> <div class="row full-height-percent"> <div class="col-lg-11 col-md-11 full-height-percent overflow-hidden"> <!--CHAT CONTAINER--> <div class="row chat-container full-height-percent animation-chat" ng-class="showChat ? \'animation-show\' : \'animation-hide\'"> <div class="col-lg-12 messages-container"> <ul class="messages"></ul> </div> <div class="col-lg-12"> <div class="input-group"> <input type="text" class="form-control" placeholder=":)"> <span class="input-group-btn"> <button class="btn btn-default" ng-click="enviarMensaje()" type="button">Go!</button> </span> </div> </div> </div> <!--USUARIOS CONECTADOS CONTAINER--> <div class="row full-height-percent animation-chat" ng-class="showUsuariosConectados ? \'animation-show\' : \'animation-hide\'"> <h3>USUARIOS CONECTADOS</h3> <ul ng-repeat="usuario in usuariosConectados"> <li>{{usuario.nombre}}</li> </ul> </div> <!--CHAT CONFIGURACION CONTAINER--> <div class="row full-height-percent animation-chat" ng-class="showChatConfiguracion ? \'animation-show\' : \'animation-hide\'"> <div class="list-group"> <h3>CONFIGURACIÓN</h3> <button type="button" class="list-group-item">Chat</button> <button type="button" class="list-group-item">Usuarios</button> <button type="button" class="list-group-item">Ayuda</button> <button type="button" class="list-group-item">Reportar problema</button> </div> </div> </div> <div class="col-lg-1 col-md-1"> <div class="row"> <div class="col-lg-12 no-padding margin-top-10"> <div class="icon-badge-container"> <button ng-click="abrirChat()" class="btn btn-default btn-lg btn-link" ng-class="showChat ? \'active\': \'\'"> <span class="glyphicon glyphicon-comment"></span> </button> <span class="badge badge-notify">{{cantidadMensajes}}</span> </div> </div> <div class="col-lg-12 no-padding margin-top-10"> <div class="icon-badge-container"> <button ng-click="abrirUsuariosConectados()" class="btn btn-default btn-lg btn-link" ng-class="showUsuariosConectados ? \'active\': \'\'"> <span class="glyphicon glyphicon-user"></span> </button> <span class="badge badge-notify">{{cantidadUsuariosConectados}}</span> </div> </div> <div class="col-lg-12 no-padding margin-top-10"> <button type="button" ng-click="abrirChatConfiguracion()" class="btn btn-default btn-lg btn-link" aria-label="Left Align" ng-class="showChatConfiguracion ? \'active\': \'\'"> <span class="glyphicon glyphicon-cog" aria-hidden="true"></span> </button> </div> </div> </div> </div> </div> </div> </div>'),a.put("views/registro.html",'<div class="container"> <div class="row"> <div class="col-md-12 formulario"> <div class="panel"> <div class="panel-heading"> <div class="panel-title">Regístrate</div> </div> <div class="panel-body"> <div custom-form f-name="FormRegistro" submit-action="guardar()" class="form-horizontal"> <div class="form-group"> <div class="col-xs-12"> <sc-input-label not-show-label="true" model="usuario.firstName" placeholder="Nombre" help-msg="Ingrese su nombre" input-name="nombreUsuario" maxlength="30" validators="[\'solo-letras\']" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-xs-12"> <sc-input-label not-show-label="true" model="usuario.lastName" placeholder="Apellido" help-msg="Ingrese su apellido" input-name="apellidoUsuario" maxlength="30" validators="[\'solo-letras\']" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-xs-12"> <sc-input-label type="email" not-show-label="true" model="usuario.email" placeholder="Email" help-msg="Ingrese su email" input-name="emailUsuario" maxlength="50" minlength="4" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-xs-12"> <sc-input-label type="password" not-show-label="true" model="usuario.password" placeholder="Contraseña" help-msg="Ingrese su contraseña, minimo 6 caracteres" input-name="passwordUsuario" maxlength="50" minlength="6" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-xs-12"> <sc-input-label type="text" not-show-label="true" model="usuario.age" placeholder="Edad" help-msg="Ingrese su edad, debe ser mayor de 18 años" input-name="edadUsuario" maxlength="2" minlength="2" validators="[\'solo-numeros\',\'sin-espacios\']" required> </sc-input-label> </div> </div> <div class="form-group"> <div class="col-md-12 buttonRegistro"> <button type="submit" class="btn btn-primary btn-md">Registrarme</button> </div> </div>  </div> </div> </div> </div> </div> </div>')}]);